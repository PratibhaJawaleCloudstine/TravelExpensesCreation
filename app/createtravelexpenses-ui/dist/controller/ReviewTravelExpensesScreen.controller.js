sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/odata/v4/ODataModel"],function(e,t,s){"use strict";return e.extend("travel.travelexpenseui.controller.ReviewTravelExpensesScreen",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("ReviewTravelExpensesScreen").attachPatternMatched(this._onRouteMatched,this)},onPreviousStep:function(){var e=sap.ui.core.routing.History.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("CreateTravelExpenseScreen",{travelId:this.travelId})}},_onRouteMatched:function(e){this.travelId=e.getParameter("arguments").travelId;console.log("Loaded Travel ID:",this.travelId);const t=this.getOwnerComponent().getModel("expenseModel");const s=t.getProperty("/expenses")||[];const a=this.getOwnerComponent().getModel("actionModel");this.sAction=a.getProperty("/actionTaken");console.log("actionTaken "+this.sAction);const o=this.byId("Rev_saveAndProceed");if(this.sAction=="save"){this.byId("Rev_id_saveDraftRadio").setEnabled(false);this.byId("Rev_id_saveAndApproveRadio").setEnabled(false);this.byId("Rev_id_ApproveRadio").setEnabled(true);this.byId("Rev_id_saveDraftRadio").setSelected(false);this.byId("Rev_id_saveAndApproveRadio").setSelected(false);this.byId("Rev_id_ApproveRadio").setSelected(true);o.setText("Send for Approval");this.selectedOption="draft"}else{this.byId("Rev_id_saveDraftRadio").setEnabled(true);this.byId("Rev_id_saveAndApproveRadio").setEnabled(true);this.byId("Rev_id_ApproveRadio").setEnabled(false);this.byId("Rev_id_saveDraftRadio").setSelected(false);this.byId("Rev_id_saveAndApproveRadio").setSelected(true);this.byId("Rev_id_ApproveRadio").setSelected(false);o.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}},onActionSelect:function(e){const t=e.getParameter("selectedIndex");const s=this.byId("Rev_saveAndProceed");if(t===0){s.setText("Save Draft");this.selectedOption="draft"}else if(t===1){s.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}else{s.setText("Send for Approval");this.selectedOption="Approve"}},onSaveAndApprove:function(){const e=this.getOwnerComponent().getModel("expenseModel");const t=e.getProperty("/expenses")||[];const s=this.getOwnerComponent().getModel("actionModel");s.setProperty("/actionTaken","save");console.log("Review expenses");console.log(t);if(this.selectedOption=="draft"){t.forEach(t=>{var s=this.getOwnerComponent().getModel();var a=s.bindList("/TravelExpenses",undefined,undefined,undefined,{$$updateGroupId:"travelExpensesGroup"});a.create({travelRequest_ID:this.travelId,expenseType:t.expenseType,receiptAmount:t.receiptAmount,receiptDate:t.receiptDate,currency:"INR"});s.submitBatch("travelExpensesGroup").then(()=>{sap.m.MessageToast.show("Travel Expenses saved successfully.");e.setProperty("/expenses",[])}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})})}else if(this.selectedOption=="SaveApprove"){var a=0;t.forEach(e=>{var s=this.getOwnerComponent().getModel();var o=s.bindList("/TravelExpenses",undefined,undefined,undefined,{$$updateGroupId:"travelExpensesGroup"});o.create({travelRequest_ID:this.travelId,expenseType:e.expenseType,receiptAmount:e.receiptAmount,receiptDate:e.receiptDate,currency:"INR"});a=a+1;s.submitBatch("travelExpensesGroup").then(()=>{sap.m.MessageToast.show("Travel Expenses saved successfully.");console.log("count of Expenses stored "+a);if(a==t.length){const e=this.getOwnerComponent().getModel("travelData");console.log("oModelTravel");console.log(e);const s=e.getData();console.log("oData");console.log(s);const a={travelRequest:{TravelRequestId:s.ID,TravelStartDate:s.startDate,TravelEndDate:s.endDate,TravelDeparture:s.departure,TravelArrival:s.arrival,TravelPlaceOfVisit:s.placeOfVisit},travelExpenses:t.map(e=>({expenseType:e.expenseType||"",receiptAmount:e.receiptAmount||"",receiptDate:e.receiptDate||""}))};$.ajax({url:"/odata/v4/travel/startTravelWorkflow",method:"POST",contentType:"application/json",data:JSON.stringify({travelData:JSON.stringify(a)}),success:function(e){sap.m.MessageToast.show("Travel request "+this.travelId+" is send for approval.")},error:function(e,t,s){sap.m.MessageBox.error("Failed to start workflow: "+e.responseText)}})}}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})})}else if(this.selectedOption=="Approve"){}}})});
//# sourceMappingURL=ReviewTravelExpensesScreen.controller.js.map