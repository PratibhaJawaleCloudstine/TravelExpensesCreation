sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/odata/v4/ODataModel"],function(e,t,a){"use strict";return e.extend("travel.travelexpenseui.controller.ReviewTravelExpensesScreen",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("ReviewTravelExpensesScreen").attachPatternMatched(this._onRouteMatched,this)},onPreviousStep:function(){var e=sap.ui.core.routing.History.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("CreateTravelExpenseScreen",{travelId:this.travelId})}},_onRouteMatched:function(e){this.travelId=e.getParameter("arguments").travelId;console.log("Loaded Travel ID:",this.travelId);const t=this.getOwnerComponent().getModel("expenseModel");const a=t.getProperty("/expenses")||[];const s=this.getOwnerComponent().getModel("actionModel");this.sAction=s.getProperty("/actionTaken");console.log("actionTaken "+this.sAction);const o=this.byId("Rev_saveAndProceed");if(this.sAction=="save"){this.byId("Rev_id_saveDraftRadio").setEnabled(false);this.byId("Rev_id_saveAndApproveRadio").setEnabled(false);this.byId("Rev_id_ApproveRadio").setEnabled(true);this.byId("Rev_id_saveDraftRadio").setSelected(false);this.byId("Rev_id_saveAndApproveRadio").setSelected(false);this.byId("Rev_id_ApproveRadio").setSelected(true);o.setText("Send for Approval");this.selectedOption="Approve"}else{this.byId("Rev_id_saveDraftRadio").setEnabled(true);this.byId("Rev_id_saveAndApproveRadio").setEnabled(true);this.byId("Rev_id_ApproveRadio").setEnabled(false);this.byId("Rev_id_saveDraftRadio").setSelected(false);this.byId("Rev_id_saveAndApproveRadio").setSelected(true);this.byId("Rev_id_ApproveRadio").setSelected(false);o.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}},onActionSelect:function(e){const t=e.getParameter("selectedIndex");const a=this.byId("Rev_saveAndProceed");if(t===0){a.setText("Save Draft");this.selectedOption="draft"}else if(t===1){a.setText("Save and Send for Approval");this.selectedOption="SaveApprove"}else{a.setText("Send for Approval");this.selectedOption="Approve"}},onSaveAndApprove:function(){const e=this.getOwnerComponent().getModel("expenseModel");const t=e.getProperty("/expenses")||[];const a=this.getOwnerComponent().getModel("actionModel");a.setProperty("/actionTaken","save");console.log("Review expenses");console.log(t);if(this.selectedOption=="draft"){t.forEach(t=>{var a=this.getOwnerComponent().getModel();var s=a.bindList("/TravelExpenses",undefined,undefined,undefined,{$$updateGroupId:"travelExpensesGroup"});s.create({travelRequest_ID:this.travelId,expenseType:t.expenseType,receiptAmount:t.receiptAmount,receiptDate:t.receiptDate,currency:"INR"});a.submitBatch("travelExpensesGroup").then(()=>{sap.m.MessageToast.show("Travel Expenses saved successfully.");e.setProperty("/expenses",[])}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})})}else if(this.selectedOption=="SaveApprove"){var s=0;t.forEach(e=>{var a=this.getOwnerComponent().getModel();var o=a.bindList("/TravelExpenses",undefined,undefined,undefined,{$$updateGroupId:"travelExpensesGroup"});o.create({travelRequest_ID:this.travelId,expenseType:e.expenseType,receiptAmount:e.receiptAmount,receiptDate:e.receiptDate,currency:"INR"});s=s+1;a.submitBatch("travelExpensesGroup").then(()=>{sap.m.MessageToast.show("Travel Expenses saved successfully.");console.log("count of Expenses stored "+s);if(s==t.length){const e=this.getOwnerComponent().getModel("travelData");console.log("oModelTravel");console.log(e);const a=e.getData();console.log("oData");console.log(a);const s={travelRequest:{TravelRequestId:a.ID,TravelStartDate:a.startDate,TravelEndDate:a.endDate,TravelDeparture:a.departure,TravelArrival:a.arrival,TravelPlaceOfVisit:a.placeOfVisit,TravelEstimationCost:a.estimatedCost,TravelSelfTravel:a.selfTravel,TravelPurposeOfTravel:a.purposeOfTravel,TravelEmployeeId:"EMP001",TravelEmployeeEmail:"pratibhapsarode@gmail.com",TravelEmployeeName:"Pratibha Jawale"},travelExpenses:t.map(e=>({expenseType:e.expenseType||"",receiptAmount:e.receiptAmount||"",receiptDate:e.receiptDate||""}))};$.ajax({url:"/odata/v4/travel/startTravelWorkflow",method:"POST",contentType:"application/json",data:JSON.stringify({travelData:JSON.stringify(s)}),success:function(e){sap.m.MessageToast.show("Travel request "+this.travelId+" is send for approval.")},error:function(e,t,a){sap.m.MessageBox.error("Failed to start workflow: "+e.responseText)}})}}).catch(e=>{sap.m.MessageBox.error("Error saving travel request: "+e.message)}).finally(()=>{this.getView().setBusy(false)})})}else if(this.selectedOption=="Approve"){const e=this.getOwnerComponent().getModel("travelData");console.log("oModelTravel");console.log(e);const a=e.getData();console.log("oData");console.log(a);const s={travelRequest:{TravelRequestId:a.ID,TravelStartDate:a.startDate,TravelEndDate:a.endDate,TravelDeparture:a.departure,TravelArrival:a.arrival,TravelPlaceOfVisit:a.placeOfVisit,TravelEstimationCost:a.estimatedCost,TravelSelfTravel:a.selfTravel,TravelPurposeOfTravel:a.purposeOfTravel,TravelEmployeeId:"EMP001",TravelEmployeeEmail:"pratibhapsarode@gmail.com",TravelEmployeeName:"Pratibha Jawale"},travelExpenses:t.map(e=>({expenseType:e.expenseType||"",receiptAmount:e.receiptAmount||"",receiptDate:e.receiptDate||""}))};$.ajax({url:"/odata/v4/travel/startTravelWorkflow",method:"POST",contentType:"application/json",data:JSON.stringify({travelData:JSON.stringify(s)}),success:function(e){sap.m.MessageToast.show("Travel request "+a.ID+" is send for approval.")},error:function(e,t,a){sap.m.MessageBox.error("Failed to start workflow: "+e.responseText)}})}}})});
//# sourceMappingURL=ReviewTravelExpensesScreen.controller.js.map